enum UserRole {
    BUYER
    SELLER
    ADMIN
}

model User {
    id              String         @id @default(uuid())
    firstName       String
    lastName        String
    email           String         @unique @db.Citext
    passwordHash    String
    oauthAccounts   OAuthAccount[]
    role            UserRole       @default(BUYER)
    isActive        Boolean        @default(true)
    isEmailVerified Boolean        @default(false)
    lastLogin       DateTime?
    createdAt       DateTime       @default(now())
    updatedAt       DateTime       @updatedAt

    sellerProfile SellerProfile?
    stores        Store[] //One seller can have multiple physical stores
    refreshTokens RefreshToken[]
}

model OAuthAccount {
    id              String   @id @default(uuid())
    provider        String
    providerId      String
    userId          String
    isEmailVerified Boolean  @default(false)
    createdAt       DateTime @default(now())

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@unique([provider, providerId])
    @@index([userId])
}

model RefreshToken {
    id        String   @id @default(uuid())
    jti       String   @unique
    tokenHash String
    userId    String
    expiresAt DateTime
    ipAddress String?
    userAgent String?
    createdAt DateTime @default(now())

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@index([userId])
}

model SellerProfile {
    id                 String             @id @default(uuid())
    userId             String             @unique
    verificationStatus VerificationStatus @default(PENDING)
    verificationNote   String? // Admin feedback if rejected
    createdAt          DateTime           @default(now())

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}
